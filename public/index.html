<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>Stock Tracker</title>

  <!-- Bootstrap theme -->
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
</head>

<body role="document">

  <!-- Fixed navbar -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Stock Tracker</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">DashBoard</a>
          </li>
          <li><a href="./admin.html">Admin Panel</a>
          </li>
          <li class="Contact">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">more <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Contact</a>
              </li>
              <li><a href="#">Contribute</a>
              </li>
              <li><a href="#">Report a Bug</a>
              </li>
              <li class="divider"></li>
              <li class="dropdown-header">About the author</li>
              <li><a href="#">Github</a>
              </li>
              <li><a href="#">Resume</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container theme-showcase" role="main">



    <div class="page-header">
      <h1></h1>
    </div>
    <div class="alert alert-success" role="alert">
      <strong>Link Up and Stable. </strong> Succesfully Connected to live stock tracker service
    </div>


    <div class="row" id="cards">
      <!-- Java Script Puts cards here -->
    </div>


    <hr/>
    <div class="well">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas sed diam eget risus varius blandit sit amet non magna. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent commodo cursus magna, vel scelerisque nisl consectetur et.
        Cras mattis consectetur purus sit amet fermentum. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Aenean lacinia bibendum nulla sed consectetur.</p>
      <button type="button" class="btn btn-info btn-lg" id="target">
        Force Reload!
      </button>
    </div>


    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <script>
      var socket = io.connect();
      var active_tiles = [];
      console.log("IO stuff should happen now...");

      socket.on('connect', function() {
        console.log("Got Conn.");
      });

      socket.on('disconnect', function() {

        console.log("Lost Conn.");
      });


      socket.on('pushQuotes', function(payload) {
        console.log("pushQuotes " + payload);

        /* Clear Old Stuff */
        var i;
        var ln = active_tiles.length;

        for (i = 0; i < ln; i++) {
          $("#" + active_tiles[i]).remove();
        }
        active_tiles.splice(0, ln);

        /* Add New Stuff */
        var card_id;

        for (i in payload) {
          card_id = "card" + i;
          active_tiles.push(card_id);

          /* Decide color scheme */
          var pchange_class;
          if (payload[i].change_p > 0) {
            pchange_class = "label label-success";
          }
          else {
            pchange_class = "label label-danger";
          }

          var quoteCard = '<div class="col-sm-4" style="width:292px" id="' + card_id + '">' +
            '<div class="panel panel-primary">' +
            '<div class="panel-heading">' +
            '<h3 class="panel-title">' + payload[i].ticker + ' (' + payload[i].exchange + ')</h3>' +
            '</div>' +
            '<div class="panel-body" style="margin-top:-15px">' +
            '<h3> <span class="' + pchange_class + '" style="float:right; margin-top:5px">' + payload[i].change_p + ' %</span> </h3>' +
            '<h2> $' + payload[i].price + '</h2>' +
            '<span style="color:gray">' + payload[i].timestamp + '</span>' +
            '</div>' +
            '</div>' +
            '</div><!-- /.col-sm-4 -->'

          console.log(payload[i]);
          $("#cards").append(quoteCard);
        }
      });


      $("#target").click(function() {
        socket.emit('requestAll');
      });
    </script>
</body>

</html>
